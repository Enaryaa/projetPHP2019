format 221
"formulaire" // application::views::formulaire
  revision 1
  modified_by 2 "lechartier"
  // class settings
  
  classdiagramsettings member_max_width 0 end
  
  classcompositediagramsettings end
  
  usecasediagramsettings end
  
  sequencediagramsettings end
  
  collaborationdiagramsettings end
  
  objectdiagramsettings end
  
  objectcompositediagramsettings end
  
  componentdiagramsettings
   end
  
  deploymentdiagramsettings
   end
  
  statediagramsettings
   end
  
  activitydiagramsettings
   end
  
  php_dir "/home/lechartier/01Programmation/PROJETS/PROJETPHP/application/views/formulaire/"
  deploymentview 132226 "formulaire"
    //deployment diagram settings
    deploymentdiagramsettings
     end
    artifact 150018 "formulaire"
      stereotype "source"
      php_src "<div class=\"container mt-3\">
  <?php echo validation_errors('<div class=\"alert alert-danger\" role=\"alert\">','</div>'); ?>
  <?php if (isset($error)) { ?><div class=\"alert alert-danger\" role=\"alert\"><p><?php echo $error;?></p></div><?php } ?>
	<div class=\"row\">
		<div class=\"col-9\">
        <?php echo form_open('formulaire'); ?>"
      associated_elems
      end
    end

    artifact 150274 "gerer"
      stereotype "source"
      php_src "
<div class=\"jumbotron jumbotron-fluid\">
  <div class=\"container\">
    <h1 class=\"display-4\">Gérer les formulaires</h1>
    <p class=\"lead\">Vous pouvez acitver, désactiver ou récupérer les resultats de vos formulaires.</p>
  </div>
</div>

<table class=\"table\">
  <thead class=\"thead-dark\">
    <tr>
      <th scope=\"col\">Titre</th>
      <th scope=\"col\">Clé</th>
      <th scope=\"col\">Date</th>
      <th scope=\"col\">#</th>
      <th scope=\"col\">Stats</th>
    </tr>
  </thead>
  <tbody>
  	<?php foreach ($formulaires as $form) {
	if (intval($form['active'])){
     	echo '<tr class=\"table-light\">';
     }
     else {
     	echo '<tr class=\"table-danger\">';
     }
    echo '<th scope=\"row\">' . $form['titre'] . '</th>
      <td>' . $form['form_key'] . '</td>
      <td>' . $form['date'] . '</td>
      <td>
      <form action=\"active\" method=\"GET\">
      <input type=\"hidden\" name=\"cle\" value=\"'. $form['form_key'] .'\" />';
     if (intval($form['active'])){
     echo	'<button type=\"submit\" class=\"btn btn-outline-danger\">Périmer</button>';
     }
     else {
     echo	'<button type=\"submit\" class=\"btn btn-success\">Activer</button>';
     }
    echo '</form></td>
        <td>
          <form action=\"'.site_url('reponse/stats').'\" method=\"GET\">
            <input type=\"hidden\" name=\"cle\" value=\"'. $form['form_key'] .'\" />
            <button type=\"submit\" class=\"btn btn-info\">Voir</button>
          </form>
        </td>
    	</tr>';
  	}
  	?>"
      associated_elems
      end
    end

    artifact 150402 "recherche"
      stereotype "source"
      php_src "<div class=\"jumbotron jumbotron-fluid\">
  <div class=\"container\">
    <h1 class=\"display-5\">Veuillez saisir la clé du formulaire auquel vous souhaitez répondre </h1>
    <h2 class=\"lead\"></h2>
  </div>
</div>
<div class=\"container\">
	<?php if (isset($wrong_key)) { ?><div class=\"alert alert-danger\" role=\"alert\"><p><?php echo $wrong_key; ?></p></div><?php } ?>
	<?php echo form_open('formulaire/show', array('method'=>'get')); ?>"
      associated_elems
      end
    end

    artifact 150530 "show"
      stereotype "source"
      php_src "<?php 

function showInputText($question) {
	$requis = '';
	if (intval($question['requis'])) {
		$requis = 'required';
	}
	echo 
	'<div class=\"form-group\">
    	<label class=\"font-weight-bold\" style=\"font-size: 1.21em!important;\" for=\"rep_'.$question['quest_id'].'\">'.$question['text_quest'].'</label>
    	<h6 class=\"font-italic\" style=\"font-size: 0.87em!important;\">'.$question['text_aide'].'</h6	>
    	<input type=\"text\" class=\"form-control\" name=\"rep['.$question['quest_id'].']\" id=\"rep_'.$question['quest_id'].'\" '.$requis.' />
  	</div>';
}

function showDate($question) {
	$requis = '';
	if (intval($question['requis'])) {
		$requis = 'required';
	}
	echo
	'<div class=\"form-group\">
    	<label class=\"font-weight-bold\" style=\"font-size: 1.21em!important;\" for=\"rep_'.$question['quest_id'].'\">'.$question['text_quest'].'</label>
    	<input class=\"form-control\" type=\"date\" value=\"'.date(\"Y-m-d\").'\" name=\"rep['.$question['quest_id'].']\" id=\"rep_'.$question['quest_id'].'\" '.$requis.' />
	</div>';
}

function showList($question, $reponses) {
	$requis = '';
	if (intval($question['requis'])) {
		$requis = 'required';
	}
	echo '<div class=\"form-group\">
		    <label class=\"font-weight-bold\" style=\"font-size: 1.21em!important;\" for=\"rep_'.$question['quest_id'].'\">'.$question['text_quest'].'</label>
    		<h6 class=\"font-italic\" style=\"font-size: 0.87em!important;\">'.$question['text_aide'].'</h6	>
		    <select class=\"form-control\" id=\"rep_'.$question['quest_id'].'\" name=\"rep['.$question['quest_id'].']\" '.$requis.'>';
		    foreach ($reponses as $key => $rep) {
		    	echo '<option>'.$rep['text_reponse'].'</option>';
		    }
	echo  '</select>
		  </div>';
}

function showRadio($question, $reponses) {
	$requis = '';
	if (intval($question['requis'])) {
		$requis = 'required';
	}
	echo '<div class=\"form-group\">
		    <label class=\"font-weight-bold\" style=\"font-size: 1.21em!important;\" for=\"rep_'.$question['quest_id'].'\">'.$question['text_quest'].'</label>
    		<h6 class=\"font-italic\" style=\"font-size: 0.87em!important;\">'.$question['text_aide'].'</h6	>';
		    foreach ($reponses as $key => $rep) {
		    	echo '<div class=\"form-check\">
					  <input class=\"form-check-input\" type=\"radio\" name=\"rep['.$question['quest_id'].']['.$rep['id_rep'].']\" id=\"rep_'.$question['quest_id'].'_'.$rep['id_rep'].'\" value=\"'.$rep['text_reponse'].'\" '.$requis.'>
					  <label class=\"form-check-label\" for=\"rep_'.$question['quest_id'].'_'.$rep['id_rep'].'\">'.$rep['text_reponse'].'</label>
					</div>';
				$requis = '';
		    }
	echo  '</div>';
}

function showCheckBox($question, $reponses) {
	echo '<div class=\"form-group\">
		    <label class=\"font-weight-bold\" style=\"font-size: 1.21em!important;\" for=\"rep_'.$question['quest_id'].'\">'.$question['text_quest'].'</label>
    		<h6 class=\"font-italic\" style=\"font-size: 0.87em!important;\">'.$question['text_aide'].'</h6	>';
		    foreach ($reponses as $key => $rep) {
		    	echo '<div class=\"form-check\">
					  <input class=\"form-check-input\" type=\"checkbox\" name=\"rep['.$question['quest_id'].']['.$rep['id_rep'].']\" id=\"rep_'.$question['quest_id'].'_'.$rep['id_rep'].'\" value=\"'.$rep['text_reponse'].'\">
					  <label class=\"form-check-label\" for=\"rep_'.$question['quest_id'].'_'.$rep['id_rep'].'\">'.$rep['text_reponse'].'</label>
					</div>';
		    }
	echo  '</div>';
}


function getReponsesByQuestionId($reponses, $question_id) {
	$mRep = [];
	foreach ($reponses as $key => $rep) {
		if ($rep['quest_id'] == $question_id) {
			$mRep[$key] = $rep;
		}
	}
	return $mRep;
}

?>

<div class=\"jumbotron jumbotron-fluid\">
  <div class=\"container\">
    <h1 class=\"display-4\"><?php echo $form['titre']; ?></h1>
    <p class=\"lead\"><?php echo $form['description']; ?></p>
  </div>
</div>

<div class=\"container\">
	
	<?php echo form_open('formulaire/send'); ?>
		<input type=\"hidden\" name=\"form_id\" value=\"<?php echo $form['form_id'] ?>\">
		<hr>
		<?php foreach ($form['question'] as $key => $question) {
			switch ($question['type_rep']) {
				case 'text':
					showInputText($question);
					break;
				case 'radio':
					showRadio($question, getReponsesByQuestionId($form['reponse'], $question['quest_id']));
					break;
				case 'checkbox':
					showCheckBox($question, getReponsesByQuestionId($form['reponse'], $question['quest_id']));
					break;
				case 'list':
					showList($question, getReponsesByQuestionId($form['reponse'], $question['quest_id']));
					break;
				case 'date':
					showDate($question);
					break;
				default:
					showInputText($question);
					break;
			}
		} ?>"
      associated_elems
      end
    end
  end

  package_ref 133250 // template
end
